name: "release extension"
description: "Generate a release for a precompiled gh extension"
inputs:
  gpg_fingerprint:
    description: "GPG fingerprint to use for signing releases"
  build_script_override:
    description: "Path to custom build script for producing binaries to upload"
  release_tag_override:
    description: "Existing tag that the release should be created from"
  release_repository_override:
    description: "The repository in which the release should be created"
  go_version:
    description: "The Go version to use for compiling (supports semver spec and ranges)"
    default: "1.18"
branding:
  color: purple
  icon: box
runs:
  using: composite
  steps:
    # TODO: figure out how to avoid setting up Go for non-Go extensions
    - uses: actions/setup-go@v3
      with:
        go-version: ${{ inputs.go_version }}
    - run: ${GITHUB_ACTION_PATH//\\//}/build_and_release.sh
      env:
        GITHUB_REPOSITORY: ${{ github.repository }}
        GITHUB_TOKEN: ${{ github.token }}
        GH_EXT_BUILD_SCRIPT: ${{ inputs.build_script_override }}
        GH_RELEASE_TAG: ${{ inputs.release_tag_override }}
        GH_TARGET_RELEASE_REPO: ${{ inputs.release_repository_override }}
        GPG_FINGERPRINT: ${{ inputs.gpg_fingerprint }}
      shell: bash
